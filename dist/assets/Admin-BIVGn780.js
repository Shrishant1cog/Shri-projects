var w=Object.defineProperty,S=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var p=(a,s,i)=>s in a?w(a,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[s]=i,u=(a,s)=>{for(var i in s||(s={}))T.call(s,i)&&p(a,i,s[i]);if(m)for(var i of m(s))E.call(s,i)&&p(a,i,s[i]);return a},g=(a,s)=>S(a,N(s));import{r as l,j as e}from"./vendor.react-CkiSaVqk.js";import{b as j}from"./index-Cj4xjNz1.js";import"./vendor-BUQXJReI.js";const k=["pending","paid","processing","shipped","delivered","cancelled","failed"];function _(){const[a,s]=l.useState([]),[i,x]=l.useState(!0),[o,y]=l.useState(null);l.useEffect(()=>{let r=!0;return(async()=>{var n;try{const d=await((n=j.currentUser)==null?void 0:n.getIdToken());if(!d)throw new Error("Not authenticated");const t=await fetch("/api/admin/orders",{headers:{Authorization:`Bearer ${d}`}});if(!t.ok)throw new Error("Not authorized or failed");const h=await t.json();r&&s(h.orders||[])}catch(d){console.error("Failed to fetch admin orders",d),r&&y(d.message)}finally{r&&x(!1)}})(),()=>{r=!1}},[]);const f=async(r,n)=>{var d;try{const t=await((d=j.currentUser)==null?void 0:d.getIdToken());if(!(await fetch("/api/admin/update-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({orderId:r,status:n})})).ok)throw new Error("Failed to update");s(v=>v.map(c=>c.id===r?g(u({},c),{status:n}):c))}catch(t){console.error("Update failed",t),alert("Failed to update order status")}};return e.jsx("section",{style:{padding:40},children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{children:"Admin Dashboard — Orders"}),i&&e.jsx("div",{className:"loading",children:"Loading…"}),o&&e.jsx("div",{className:"card",style:{padding:12,color:"red"},children:o}),!i&&!o&&a.length===0&&e.jsx("div",{className:"card",style:{padding:12},children:"No orders found."}),!i&&!o&&a.length>0&&e.jsx("div",{className:"orders-list",children:a.map(r=>{var n,d;return e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Order:"})," ",r.razorpay_order_id||r.order_id||r.id]}),e.jsx("div",{style:{marginTop:6},children:e.jsxs("small",{children:["Payment ID: ",r.razorpay_payment_id||"-"]})}),e.jsx("div",{style:{marginTop:6},children:e.jsxs("small",{children:["Customer: ",((n=r.customer)==null?void 0:n.name)||((d=r.customer)==null?void 0:d.email)||r.uid||"—"]})})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{children:["₹",(r.amount/100).toLocaleString()]}),e.jsx("div",{style:{marginTop:8},children:e.jsx("select",{value:r.status||"pending",onChange:t=>f(r.id,t.target.value),children:k.map(t=>e.jsx("option",{value:t,children:t},t))})})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("strong",{children:"Items"}),e.jsx("ul",{children:(r.items||[]).map(t=>e.jsxs("li",{children:[t.name," × ",t.qty," — ₹",(t.price*t.qty).toLocaleString()]},t.id))})]})]},r.id)})})]})})}export{_ as default};
