const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cj4xjNz1.js","assets/vendor.react-CkiSaVqk.js","assets/vendor-BUQXJReI.js","assets/index-COilr1xg.css"])))=>i.map(i=>d[i]);
var D=Object.defineProperty,I=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var N=(r,o,s)=>o in r?D(r,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[o]=s,b=(r,o)=>{for(var s in o||(o={}))A.call(o,s)&&N(r,s,o[s]);if(v)for(var s of v(o))F.call(o,s)&&N(r,s,o[s]);return r},w=(r,o)=>I(r,q(o));import{u as L,a as J,_ as S}from"./index-Cj4xjNz1.js";import{r as U,u as V,j as e}from"./vendor.react-CkiSaVqk.js";import"./vendor-BUQXJReI.js";function H(){const{cartItems:r,getTotalPrice:o,clearCart:s}=L(),{user:m}=J(),[a,z]=U.useState({name:(m==null?void 0:m.displayName)||"",email:(m==null?void 0:m.email)||"",phone:"",address:"",city:"",pincode:""}),j=o(),f=j+0,h=t=>{const{name:n,value:d}=t.target;z(l=>w(b({},l),{[n]:d}))},k=t=>{if(t.preventDefault(),!a.name||!a.email||!a.phone||!a.address||!a.city||!a.pincode){alert("Please fill all the delivery details.");return}if(r.length===0){alert("Your cart is empty.");return}T(f)},C=V();async function P(){return new Promise(t=>{if(window.Razorpay)return t(!0);const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>t(!0),n.onerror=()=>t(!1),document.body.appendChild(n)})}async function T(t){if(r.length===0){alert("Your cart is empty.");return}try{let n=null;try{const{auth:i}=await S(async()=>{const{auth:y}=await import("./index-Cj4xjNz1.js").then(u=>u.f);return{auth:y}},__vite__mapDeps([0,1,2,3]));n=await i.currentUser.getIdToken()}catch(i){}const d={"Content-Type":"application/json"};n&&(d.Authorization=`Bearer ${n}`);const l=await fetch("/api/razorpay-order",{method:"POST",headers:d,body:JSON.stringify({amount:Math.round(t*100),currency:"INR",orderData:{items:r,customer:{name:a.name,email:a.email,phone:a.phone}}})});if(!l.ok){const i=await l.text();console.error("Order API failed",i),alert("Failed to create payment order. Try again later.");return}const p=await l.json();if(!await P()){alert("Unable to load payment SDK. Try again later.");return}const E={key:void 0,amount:p.amount,currency:p.currency,name:"ShriStore",description:"Order payment",order_id:p.id,handler:function(i){const y={razorpay_order_id:i.razorpay_order_id,razorpay_payment_id:i.razorpay_payment_id,razorpay_signature:i.razorpay_signature,amount:p.amount,currency:p.currency,createdAt:Date.now(),items:r};(async()=>{try{let u=null;try{const{auth:c}=await S(async()=>{const{auth:O}=await import("./index-Cj4xjNz1.js").then(R=>R.f);return{auth:O}},__vite__mapDeps([0,1,2,3]));u=await c.currentUser.getIdToken()}catch(c){}const _={"Content-Type":"application/json"};u&&(_.Authorization=`Bearer ${u}`);const x=await fetch("/api/razorpay-verify",{method:"POST",headers:_,body:JSON.stringify({razorpay_order_id:i.razorpay_order_id,razorpay_payment_id:i.razorpay_payment_id,razorpay_signature:i.razorpay_signature})});if(!x.ok&&x.status===400){const c=await x.text();console.error("Verification failed:",c),alert("Payment verification failed on server. Please contact support.");return}try{const c=JSON.parse(localStorage.getItem("shri_orders")||"[]");c.push(y),localStorage.setItem("shri_orders",JSON.stringify(c)),localStorage.setItem("shri_last_order",JSON.stringify(y))}catch(c){console.warn("Failed to save order locally",c)}s(),C("/order-success")}catch(u){console.error("Error verifying order",u),alert("Error while verifying order. Please contact support.")}})()},prefill:{name:a.name,email:a.email,contact:a.phone},theme:{color:"#6f42c1"}},g=new window.Razorpay(E);g.on("payment.failed",function(i){console.error("Payment failed",i),alert("Payment failed. Please try again.")}),g.open()}catch(n){console.error(n),alert("Payment failed. Try again later.")}}return r.length===0?e.jsx("section",{className:"checkout-page fade-in",style:{padding:40},children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{children:"Checkout"}),e.jsx("p",{children:"Your cart is empty. Add items before checking out."})]})}):e.jsx("section",{className:"checkout-page fade-in",style:{padding:40},children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"checkout-title",children:"Checkout"}),e.jsxs("div",{className:"checkout-layout",children:[e.jsxs("form",{className:"checkout-form card",onSubmit:k,children:[e.jsx("h3",{children:"Delivery Details"}),e.jsxs("label",{children:["Full Name",e.jsx("input",{type:"text",name:"name",value:a.name,onChange:h,required:!0})]}),e.jsxs("label",{children:["Email",e.jsx("input",{type:"email",name:"email",value:a.email,onChange:h,required:!0})]}),e.jsxs("label",{children:["Phone Number",e.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:h,required:!0})]}),e.jsxs("label",{children:["Address",e.jsx("textarea",{name:"address",value:a.address,onChange:h,rows:"3",required:!0})]}),e.jsxs("div",{className:"checkout-row",children:[e.jsxs("label",{children:["City",e.jsx("input",{type:"text",name:"city",value:a.city,onChange:h,required:!0})]}),e.jsxs("label",{children:["Pincode",e.jsx("input",{type:"text",name:"pincode",value:a.pincode,onChange:h,required:!0})]})]}),e.jsxs("button",{type:"submit",className:"btn pay-button bounce-button",children:["Proceed to Payment (₹",f.toLocaleString(),")"]}),e.jsxs("p",{className:"small-note",children:["Delivery charges: ",e.jsx("strong",{children:"FREE"})," for now."]})]}),e.jsxs("aside",{className:"checkout-summary card slide-up",children:[e.jsx("h3",{children:"Order Summary"}),e.jsx("ul",{className:"summary-items",children:r.map(t=>{var d,l;const n=(l=(d=t.qty)!=null?d:t.quantity)!=null?l:1;return e.jsxs("li",{className:"summary-item",children:[e.jsxs("span",{children:[t.name," × ",n]}),e.jsxs("span",{children:["₹",(t.price*n).toLocaleString()]})]},t.id)})}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",j.toLocaleString()]})]}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{className:"free",children:"FREE"})]}),e.jsxs("div",{className:"summary-line summary-total",children:[e.jsx("span",{children:"Total to pay"}),e.jsxs("span",{children:["₹",f.toLocaleString()]})]}),e.jsx("button",{className:"btn secondary-btn bounce-button",type:"button",onClick:s,children:"Clear Cart"}),e.jsx("p",{className:"small-note",children:"On Razorpay, please enter this total amount manually for now."})]})]})]})})}export{H as default};
